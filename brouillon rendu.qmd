---
title: "Brouillon rendu"
format: 
  html:
    citeproc: false
    filters:
      - "citeproc.lua"
      - "wordcount.lua"
editor: visual
author: "jacopo hilde leopold"
code-fold: true
---

# 1 Introduction

Le sujet de la mobilité sociale et des inégalités des chances dans l’école est au centre du débat académique en France depuis longtemps. Graduellement, l’analyse sociologique sur le sujet a été intégré dans l’analyse publique au sein de l’INSEE et du ministère de l’Éducation, qui publient régulièrement des rapports, des notes d’information, et collectent des données sur des sujets clés comme les disparités sociales et territoriales dans l’éducation. Par exemple, le rapport annuel « France, portrait sociale » qui est publié depuis 1997 s’occupe régulièrement du thème des inégalités scolaires (e.g., INSEE 1997, INSEE 2003, INSEE 2025). Ainsi, au niveau international, l’OECD dédie régulièrement des chapitres à la mobilité sociale dans l’éducation dans ses rapports du Programme international pour le suivi des acquis des élèves (PISA ; e.g., OECD 2018).

L’indice de position sociale (IPS) pour les écoles en France existe depuis l’année 2016-2017. Il a été créé par la Direction de l'évaluation, de la prospective et de la performance (DEPP) au sein du ministère de l’Éducation. L’indice a été créé comme une tentative d’examiner les inégalités sociales à l’école dans une maniéré plus multiforme (Rochet 2016). Dans le passé, l’origine sociale des élèves a été surtout mesurée à travers la profession et catégorie sociale (PCS) de leurs parents ou le pourcentage d'élèves boursiers dans un établissement, qui rendent une image partielle sur le sujet. En plus, l’indice a l’objectif de créer une mesure quantitative de l’origine sociale, pour permettre plus facilement l’agrégation des données au niveau de l’établissement, de la commune, du département, etc. L’indice regroupe diffèrent catégories de données relatives à la famille d’origine des étudiants, à travers l’analyse en composantes principales. Les catégories incluent : la catégorie socio-professionnelle (PCS) et le niveau d'instruction des parents, la structure familiale (monoparentale, etc.), le conditions matérielles (revenue, taille du logement, accès a internet, etc.), et l’accès à certaines formes de capitale culturelle. Selon les auteurs, l’indice « devrait procurer un avantage pratique selon au moins deux axes d’analyse : décrire les inégalités sociales à l’école ; étudier les relations entre la performance scolaire et l’origine sociale » (Rochet 2016 : 22).

Dans cette analyse, l'IPS sera étudié en relation avec deux autres groupes d'indicateurs pour les lycées : les Indicateurs de Valeur Ajoutée des Lycées (IVAL) et l'indice d’éloignement.

Les IVAL évaluent l'efficacité d'un établissement en mesurant sa capacité à faire progresser ses élèves au-delà des simples taux de réussite bruts au baccalauréat. La « valeur ajoutée » est calculée en comparant les résultats obtenus à ceux attendus, après avoir neutralisé l'influence de facteurs externes tels que le niveau scolaire initial et le profil sociodémographique des élèves, incluant l'IPS. Un indicateur positif signifie que le lycée a mieux accompagné ses élèves que des établissements comparables, mettant ainsi en lumière son action pédagogique propre. Ces indicateurs concernent uniquement les lycées publics et privés sous contrat disposant d'un cycle complet et d'un nombre suffisant de candidats.

L'indice d’éloignement synthétise l'isolement géographique des établissements selon plusieurs dimensions : le lieu de résidence des élèves, l’offre d’enseignement et les équipements aux alentours.

À partir de ces trois indicateurs, cette analyse a pour objectif d'explorer dans quelle mesure l’indice de position sociale (IPS) et l’éloignement géographique conditionnent la performance des différents lycées, publics et privés, au sein des départements français. De plus, la recherche examine dans quelle proportion l'IVAL permet de compenser ces déterminants sociaux, en étudiant en particulier les effets de la réforme du baccalauréat. 

# 2 Méthodologie et sources

Cette étude s’appuie sur trois sources de données publiées par le ministère de l'Éducation nationale : l'indice de position sociale (IPS), les indicateurs de valeur ajoutée des lycées (IVAL) et l'indice d'éloignement. Le logiciel R a été utilisé pour l'ensemble de l'analyse statistique et de la production du rapport.

L'IPS, mesuré depuis 2016, a été extrait de trois bases de données distinctes, unifiées pour les besoins de l'analyse. Les données de l'IVAL, disponibles depuis 2013, distinguent les lycées d'enseignement général et technologique (GT) des lycées professionnels. Enfin, les données sur l'éloignement sont accessibles pour la période allant de 2020 à 2024. Afin de standardiser les résultats, ce travail se concentre exclusivement sur les établissements d'enseignement général et technologique. Les années scolaires 2016-2017, 2020-2021 et 2023-2024 ont été isolées pour faire l'objet d'un examen approfondi. Un travail préparatoire a été nécessaire pour traiter les données manquantes et harmoniser les noms des départements et des communes afin de permettre la représentation cartographique.

À partir de ces sources, l'analyse mobilise diverses méthodes statistiques pour appréhender les dynamiques sociales des lycées français. Dans un premier temps, des régressions linéaires sont exploitées pour tester l'influence de l'IPS sur l'IVAL et comparer les secteurs public et privé. Ensuite, via des outils de statistique descriptive et de cartographie, la recherche explore les disparités territoriales liées à l'éloignement. Enfin, l'impact de la réforme du baccalauréat est évalué à travers l'évolution de l'IVAL entre 2016 et 2024.

Pour conclure, une note méthodologique sur l'usage de l'IA. Des outils d'intelligence artificielle générative (LLM) ont été utilisés pour la rédaction du code R de cette analyse. En particulier, l'IA a été exploitée pour corriger le code en cas d'erreurs et pour améliorer l'apparence des graphiques et des cartographies. L'utilisation de l'IA a toujours été faite avec un regard critique et analytique, en vérifiant manuellement le code à chaque fois.

# 3 Analysis

```{r, eval = FALSE}

#pour pouvoir convertir le markdown en pdf sans latex (il faut l'enlever du document une fois qu'on l'a installé)

install.packages('tinytex')
tinytex::install_tinytex()  # install TinyTeX
```

```{r, echo = FALSE, message = FALSE}

rm(list=ls(all=TRUE))
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(knitr)
library(here)
library(plotly)
library(here)
library(tidyverse)
library(cartogram)
library(sf)
library(tidyverse)
library(spData)
library(tmap)
library(cartogram)


# Importation des donnees:
here::i_am("M2SES.Rproj")

Annuaire <- vroom("fr-en-annuaire-education.csv")
ParcourSup <- vroom("fr-esr-parcoursup.csv")
Eloignement <- vroom("fr-en-indice_eloignement_lycee_ap2020.csv")

IPS <- vroom("fr-en-ips_lycees.csv")
IPS_2022_2023 <- vroom("fr-en-ips-lycees-ap2022.csv")
IPS_2023_2024 <- vroom("fr-en-ips-lycees-ap2023.csv")

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

# les donnees pour le Geoplot selon les regions
st_layers("France_entiere.gpkg")
region <- st_read("France_entiere.gpkg", layer="region")
region <- region |> rename(region="nom_officiel_en_majuscules")

# les donnees pour le Geoplot selon les communes (seulement France metropolitaine parce que trop compliqué de zoomé dans la carte complete)
st_layers("Carto_France.gpkg")
communes <- st_read("Carto_France.gpkg", layer="commune")
communes <- communes |> rename(commune="nom_officiel_en_majuscules")


#transformer un d.f en objet sf --> st_as_sf(objet):
IVAL_gt <-IVAL_gt %>% filter(Année == 2016 | Année==2020 | Année==2024)

#faire pivoter les IVAL pour les avoirs en colomne et se débarraser des lignes par années:
IVAL_gt <- IVAL_gt %>% rename(IVAL = `Valeur ajoutée du taux de réussite - Toutes séries`) 

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_gt <- IVAL_gt %>% select(UAI, Année, IVAL, Secteur, `Taux d'accès 2nde-bac`, `Taux de réussite - Toutes séries`) %>%
  mutate(secteur_public = if_else(Secteur == "public", 1, 0)) %>% select(-Secteur) %>%
    pivot_wider(
    names_from = Année,
    values_from = c(IVAL, `Taux d'accès 2nde-bac`, `Taux de réussite - Toutes séries` ),
    names_glue = "{.value}_{Année}"
  )

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)


#Pareil pour l'éloignement:
Eloignement <- Eloignement %>% filter(Année=="2020" | Année=="2024" ) %>%  select(UAI, Année, `Indice éloignement` ) %>%
    pivot_wider(
    names_from = Année,
    values_from = `Indice éloignement`,
    names_glue = "{.value}_{Année}"
  ) 


Eloignement %>%
  count(UAI) %>%
  filter(n > 1)



# Unifier le tables IPS
IPS_pivot_2016 <- IPS |> select(`Rentrée scolaire`, UAI, `IPS voie GT`, Secteur) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")

IPS_pivot_2022 <- IPS_2022_2023 |> select(`Rentrée scolaire`, UAI, `IPS voie GT`) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")

IPS_pivot_2024 <- IPS_2023_2024 |> select(`Rentrée scolaire`, UAI, `IPS voie GT`) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")


IPS_gt <- IPS_pivot_2016 |> left_join(IPS_pivot_2022) |> left_join(IPS_pivot_2024) |> filter(!is.na(`IPS 2016-2017`)) %>% select(`IPS 2016-2017`, `IPS 2020-2021`,`IPS 2024-2025`, UAI )


IPS_gt %>%
  count(UAI) %>%
  filter(n > 1)


IVAL_IPS_gt <- inner_join(IVAL_gt,IPS_gt, by = "UAI")

IVAL_IPS_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(Eloignement, by = "UAI")

#remettre les communes mtn.

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt <- IVAL_gt %>% 
  filter(Année %in% c(2016, 2020, 2024)) %>% 
  select(UAI, Region, Département, Académie, Commune, `Code commune`) %>% 
  distinct(UAI, .keep_all = TRUE)

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(IVAL_gt, by = "UAI")





# on n'a pas besoin de la suite, c'est ca?

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(Eloignement, by = "UAI")

#remettre les communes mtn.

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt <- IVAL_gt %>% 
  filter(Année %in% c(2016, 2020, 2024)) %>% 
  select(UAI, Region, Département, Académie, Commune, `Code commune`) %>% 
  distinct(UAI, .keep_all = TRUE)

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(IVAL_gt, by = "UAI")

```
# Regression
montrer qu'il y a une causalité entre le IPS et le IVAL?

```{r}
# je met mes regressions. Elles sont faites sur une seule année : 2020.

IVAL_gt_2020 <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt_2020 <- IVAL_gt_2020 %>% filter(Année ==2020 )

IVAL_gt_2020 %>% count(UAI)

Eloignement_2020 <- vroom("fr-en-indice_eloignement_lycee_ap2020.csv")  %>% filter(Année ==2020)

# ici nous avons, juste pour 2020, l'IVAL et l'éloignement. On va cleaner et merge avec IPS.
IVAL_gt_eloignement_2020 <- merge(IVAL_gt_2020, Eloignement_2020, by = "UAI") 
IVAL_gt_eloignement_2020 <- IVAL_gt_eloignement_2020 %>% select(UAI, Etablissement, `Code région`,`Taux de réussite - Toutes séries`, `Valeur ajoutée du taux de réussite - Toutes séries`, `Indice éloignement`, `Taux d'accès 2nde-bac`)

IPS_2020 <- IPS %>% filter(`Rentrée scolaire`=="2020-2021")

IPS_IVAL_ELOI_2020 <- merge(IPS_2020, IVAL_gt_eloignement_2020, by = "UAI" ) %>% select(UAI,`Code du département`,Etablissement, Secteur, `IPS voie GT`,`Taux de réussite - Toutes séries`, `Valeur ajoutée du taux de réussite - Toutes séries`, `Indice éloignement`, `Taux d'accès 2nde-bac`) 

IPS_IVAL_ELOI_2020 <- IPS_IVAL_ELOI_2020 %>%   mutate(secteur_public = if_else(Secteur == "public", 1, 0)) %>% select(-Secteur)


reg1_2020 <- lm(
  `Valeur ajoutée du taux de réussite - Toutes séries` ~ 
    `Indice éloignement` + secteur_public + `IPS voie GT`,
  data = IPS_IVAL_ELOI_2020
)

summary(reg1_2020)

# premier résultat : cette régression n'explique PAS l'IVAL. Donc : l'IVAL est bien corrigé de l'IPS (on ne trouve pas un IVAL meilleur là où il y a des IPS élevés, même après correction), l'éloignement n'a pas d'effet sur l'IVAL, et le fait d'être public oui. Donc, piste à explorer sur le secteur public et privé. 



#régression du taux de réussite par secteur/IPS/eloignement.
reg2_2020 <- lm(
  `Taux de réussite - Toutes séries` ~ 
    `Indice éloignement` + secteur_public + `IPS voie GT`,
  data = IPS_IVAL_ELOI_2020
)

summary(reg2_2020)

# 1/3 de la variation du taux de réussite (en 2020, bac général) est expliquée par IPS + eloignement + secteur. Effet positif de l'IPS et de l'éloignement (effets robustes mais légers), effet négatif du secteur public. (effet fort et robuste). Conclusion (simple) : lycées privés = meilleur taux de réussite.
```

#analyse en composantes principales. Je vais mettre au propre avec interpretation.

```{r}

# ===== ANALYSE EN COMPOSANTES PRINCIPALES =====

# Préparer les données pour l'ACP
# Identifier les colonnes qualitatives (géographiques)
cols_quali <- c("Region", "Département", "Académie", "Commune", "Code commune")

# Identifier la position de secteur_public et des colonnes qualitatives
data_acp_full <- IVAL_IPS_gt %>%
  select(-UAI) %>%
  na.omit()

# Trouver les indices des colonnes
idx_secteur <- which(names(data_acp_full) == "secteur_public")
idx_quali <- which(names(data_acp_full) %in% cols_quali)

cat("Dimensions des données:", dim(data_acp_full), "\n")
cat("Colonne secteur_public:", idx_secteur, "\n")
cat("Colonnes qualitatives:", idx_quali, "\n")

# ===== 1. MATRICE DE CORRÉLATION =====
# Sélectionner uniquement les variables quantitatives actives
data_quanti <- data_acp_full %>% 
  select(-all_of(cols_quali), -secteur_public)

corrplot(cor(data_quanti), method="circle", type="upper", 
         tl.cex = 0.6, tl.col = "black")

# ===== 2. ACP avec variables supplémentaires =====
# secteur_public comme variable quantitative supplémentaire
# variables géographiques comme variables qualitatives supplémentaires
lycees_pca <- PCA(data_acp_full, 
                  graph = FALSE, 
                  scale.unit = TRUE, 
                  quanti.sup = idx_secteur,
                  quali.sup = idx_quali)

# ===== 3. VALEURS PROPRES =====
cat("\n===== VALEURS PROPRES =====\n")
print(lycees_pca$eig)

# Graphique des valeurs propres (scree plot)
fviz_screeplot(lycees_pca, addlabels = TRUE, choice = "variance") +
  ggtitle("Éboulis des valeurs propres - Lycées français")

# ===== 4. ANALYSE DES VARIABLES =====
cat("\n===== RÉSULTATS POUR LES VARIABLES =====\n")
print(lycees_pca$var)

# Graphique des variables (base)
plot(lycees_pca, choix="var")

# Contribution des variables à l'axe 1
fviz_contrib(lycees_pca, choice ="var", axes = 1) +
  ggtitle("Contribution des variables à l'axe 1 (Dim 1)")

# Contribution des variables à l'axe 2
fviz_contrib(lycees_pca, choice ="var", axes = 2) +
  ggtitle("Contribution des variables à l'axe 2 (Dim 2)")

# Cercle de corrélation avec gradient de couleurs
fviz_pca_var(lycees_pca, col.var = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE) +
  ggtitle("Cercle des corrélations - Variables actives")

# ===== 5. ANALYSE DES INDIVIDUS =====

# Graphique des individus (base)
plot(lycees_pca, choix="ind")

# Graphique coloré par cos2 (qualité de représentation)
plot(lycees_pca, choix="ind", habillage="cos2")

# Sélection des individus bien représentés (cos2 > 0.7)
plot(lycees_pca, choix="ind", select="cos2 0.7")

# Graphique avancé avec gradient de couleurs
fviz_pca_ind(lycees_pca, col.ind = "cos2", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE,
             pointsize = 1,
             labelsize = 2,
             select.ind = list(cos2 = 100)) +
  ggtitle("Projection des lycées (100 mieux représentés)")

# ===== 6. BIPLOT =====
fviz_pca_biplot(lycees_pca, 
                repel = TRUE,
                col.var = "#2E9FDF",
                col.ind = "#696969",
                pointsize = 1,
                labelsize = 3,
                select.ind = list(cos2 = 50)) +
  ggtitle("Biplot - Variables et lycées")

# ===== 7. ANALYSE PAR RÉGION (variable supplémentaire) =====
# Graphique des individus colorés par région
fviz_pca_ind(lycees_pca, 
             geom.ind = "point",
             col.ind = data_acp_full$Region,
             palette = "jco",
             addEllipses = TRUE,
             legend.title = "Région") +
  ggtitle("Projection des lycées par région")

# ===== 8. RÉSUMÉ DES RÉSULTATS =====
cat("\n===== RÉSUMÉ DE L'ACP =====\n")
cat("Variance expliquée par les 5 premiers axes:\n")
print(round(lycees_pca$eig[1:5, 2], 2))
cat("\nVariance cumulée:\n")
print(round(lycees_pca$eig[1:5, 3], 2))

```





# Eloignement

## Indice moyen d'éloignement par region et par académie pour 2024
```{r}

# Indice moyen d'éloignement par region pour 2024 ?

Eloi2024_Reg <- IVAL_IPS_gt |> group_by(Region)  |> summarize(moyenne_eloignement_2024 = mean(`Indice éloignement_2024`, na.rm = TRUE)) |> rename(region="Region") 
  
ggplot(Eloi2024_Reg, aes(x = fct_reorder(region, moyenne_eloignement_2024), 
           y = moyenne_eloignement_2024, 
           fill = moyenne_eloignement_2024)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Indice moyen d'éloignement par region (2024)",
    x = "Region",
    y = "Indice moyen"
  ) + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}

# Indice moyen d'éloignement par académie pour 2024 ?
# je propose qu'on enleve ca, parce-que on n'arrive pas a faire le geoplot avec les academies, et c'est un peu double avec eloignement sur region

Eloi2024_Acad <- IVAL_IPS_gt %>% group_by(Académie)  %>% summarise(moyenne_eloignement_2024 = mean(`Indice éloignement_2024`, na.rm = TRUE)) 
  
ggplot(Eloi2024_Acad, aes(x = fct_reorder(Académie, moyenne_eloignement_2024), 
           y = moyenne_eloignement_2024, 
           fill = moyenne_eloignement_2024)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Indice moyen d'éloignement par académie (2024)",
    x = "Académie",
    y = "Indice moyen"
  ) + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

L'analyse au niveau régional et d'académie montre une différence de plus de 20 % entre les territoires présentant les niveaux d'éloignement les plus faibles et ceux présentant les niveaux les plus élevés. 

En particulier, l'Île-de-France est la région où l'éloignement est le moins présent, ce qui se reflète également au niveau des académies, Paris, Créteil et Versailles occupant les premières places en termes de faibles niveaux d'éloignement. Cela n'a rien d'étonnant, car l'Île-de-France est la région la plus urbanisée de France, avec une forte densité de population, un réseau de transports très développé et des services publics et des écoles répartis sur un territoire relativement restreint. L'ensemble de ces éléments facilite l'accès à l'éducation pour les jeunes qui résident dans cette région. 

Confirmant le fait que le taux d'urbanisation semble positivement corrélé à de faibles niveaux d'éloignement, les autres académies hors Île-de-France où l'indice est le plus faible sont Lyon, Strasbourg, Lille, et Aix-Marseille. Toutes des zones urbanisées comprenant des villes moyennes ou grandes. Dans le même temps, la présence d'une grande ville ne suffit pas à elle seule à réduire l'éloignement : par exemple, les académies de Toulouse et de Bordeaux ont des niveaux relativement élevés par rapport à la moyenne, même en présence de centres urbains importants, ce qui montre que l'accès à l'éducation dépend de nombreux facteurs. En outre, il convient de mentionner que la plupart des régions et des académies de France métropolitaine ont des niveaux d'éloignement relativement similaires, même dans les territoires où la densité de population est faible.

La situation est différente pour la Corse, la Guyane et la Guadeloupe, qui se distinguent par des niveaux d'éloignement largement supérieurs à la moyenne, tant au niveau des académies que des régions. Cela semble témoigner de la difficulté du système éducatif français à garantir les mêmes droits d'accès à l'éducation en dehors de la France métropolitaine.

# Visualisation des Geodonnees en relation avec l'eloignement

## Indice moyen d'eloignement par Département en 2024 pour la France metropolitaine et les territoires d'outre-mer

```{r}
Eloi2024_Dep <- IVAL_IPS_gt |> group_by(Département)  |> summarize(moyenne_eloignement_2024 = mean(`Indice éloignement_2024`, na.rm = TRUE)) |> rename(Département="Département") 

departement <- st_read("France_entiere.gpkg", layer="departement")
departement <- departement |> rename(Département="nom_officiel_en_majuscules")

departement <- departement |> 
  mutate(Département = case_when(
      Département == "ALPES-DE-HAUTE-PROVENCE" ~ "ALPES-DE-HTE-PROVENCE",
      Département == "HAUTE-SAVOIE" ~ "HAUTE SAVOIE",
      Département == "COTE-D'OR" ~ "COTE D'OR", 
      Département == "COTES-D'ARMOR" ~ "COTES D'ARMOR",
      Département == "SEINE-MARITIME" ~ "SEINE MARITIME",
      TRUE ~ Département))


departement_eloi <- departement |> select(Département, code_insee, code_siren, geometrie) |> right_join(Eloi2024_Dep, by="Département")

metropole <- departement_eloi |> filter(!grepl("^97", code_insee))
guadeloupe <- departement_eloi |> filter(code_insee == "971")
martinique <- departement_eloi |> filter(code_insee == "972")
guyane     <- departement_eloi |> filter(code_insee == "973")
reunion    <- departement_eloi |> filter(code_insee == "974")
mayotte    <- departement_eloi |> filter(code_insee == "976")

tm_shape(metropole) + tm_fill(fill="moyenne_eloignement_2024",
                             fill.scale=tm_scale_intervals(values="kovesi.blue", n=10,
                                                           style="quantile"),
                              fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_layout(frame=FALSE, component.autoscale = FALSE) + tm_title ("France métropolitaine", frame = TRUE) +
  tm_borders(col = "darkblue", lwd = 0.3)
                                    

m_gua <- tm_shape(guadeloupe) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Guadeloupe") + tm_borders(col = "darkblue", lwd = 0.3)
m_mar <- tm_shape(martinique) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Martinique") + tm_borders(col = "darkblue", lwd = 0.3)
m_guy <- tm_shape(guyane) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Guyane") + tm_borders(col = "darkblue", lwd = 0.3)
m_reu <- tm_shape(reunion) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Réunion") + tm_borders(col = "darkblue", lwd = 0.3)
m_may <- tm_shape(mayotte) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Mayotte") + tm_borders(col = "darkblue", lwd = 0.3)

tmap_arrange(m_gua, m_mar, m_guy, m_reu, m_may, ncol = 5, nrow = 1)
```

# IVAL

```{r}
# IVAL selon les communes 2016 (geoplot) ?
# faut encore y travailler

IVAL_2016 <- IVAL_IPS_gt |> rename(commune="Commune") |> select(IVAL_2016, commune) 

IVAL_communes <- communes |>  select(commune, code_insee, geometrie) |> right_join(IVAL_2016, by="commune") 


tm_shape(IVAL_communes) + tm_fill(fill="IVAL_2016",
                             fill.scale=tm_scale_intervals(values="kovesi.blue", n=5
                                                           style="quantile")) + tm_layout(frame =FALSE, component.autoscale = FALSE)
```

# Public et privé

```{r}

# nombre de lycées privés par académie.

priv_acad <- IVAL_IPS_gt %>%
  filter(secteur_public == 0) %>%         
  group_by(Académie) %>%
  summarise(nb_prives = n()) 

ggplot(priv_acad, aes(x=fct_reorder(Académie,nb_prives), y=nb_prives, fill=nb_prives)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
#IPS moyen par Académie. Peut être qu'il faut recflechir à des pondérations...
IVAL_IPS_gt <- IVAL_IPS_gt %>%
  mutate(IPS_moy_lycee = rowMeans(
    select(., `IPS 2016-2017`, `IPS 2020-2021`, `IPS 2024-2025`),
    na.rm = TRUE
  ))

IPS_acad <- IVAL_IPS_gt %>%
  group_by(Académie) %>%
  summarise(IPS_moyen = mean(IPS_moy_lycee, na.rm = TRUE))

IPS_acad %>% ggplot(aes(x=fct_reorder(Académie,IPS_moyen), y=IPS_moyen, fill=IPS_moyen)) + geom_bar(stat="identity") + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
# Partie ou on interroge l'effet de la réforme du bac.

```{r}

ggplot(IVAL_IPS_gt, aes(x = IVAL_2016)) +
  geom_density(fill = "steelblue", alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  theme_minimal() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  labs(
    title = "Distribution de l’IVAL par année",
    x = "IVAL",
    y = "Densité"
  )

ggplot(IVAL_IPS_gt, aes(x = IVAL_2020)) +
  geom_density(fill = "steelblue", alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  theme_minimal() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  labs(
    title = "Distribution de l’IVAL par année",
    x = "IVAL",
    y = "Densité"
  )

ggplot(IVAL_IPS_gt, aes(x = IVAL_2024)) +
  geom_density(fill = "steelblue", alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  theme_minimal() +
  labs(
    title = "Distribution de l’IVAL par année",
    x = "IVAL",
    y = "Densité"
  )

```

```{r}
library(reshape2)  

IVAL_compare <- IVAL_IPS_gt %>%
  select(IVAL_2016, IVAL_2024) %>%
  pivot_longer(cols = everything(), names_to = "annee", values_to = "IVAL")

ggplot(IVAL_compare, aes(x = IVAL, fill = annee)) +
  geom_density(alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  theme_minimal() +
  scale_fill_manual(values = c("steelblue", "tomato")) +
  labs(
    title = "Comparaison des distributions de l’IVAL : 2016 vs 2024",
    x = "IVAL",
    y = "Densité",
    fill = "Année"
  )
```

```{r}

#ici je calcule la variation de l'IVAL de chaque lycée, avant et après la réforme du bac, et aussi l'IPS moyen du lycée sur les 3 années.
IVAL_IPS_gt <- IVAL_IPS_gt %>%
  mutate(var_IVAL_1624 = IVAL_2024 - IVAL_2016) %>%
  mutate(IPS_moy_lycee = rowMeans(
    select(., `IPS 2016-2017`, `IPS 2020-2021`, `IPS 2024-2025`),
    na.rm = TRUE
  ))


  var_IVAL_privés <- ggplot(IVAL_IPS_gt %>% filter(secteur_public == 0),
       aes(x =IPS_moy_lycee , y = var_IVAL_1624)) +
  geom_point(alpha = 0.6, size = 2, color = "tomato") +
  theme_minimal() +
  labs(
    title = "Variation des IVAL - Lycées privés",
    x = "IPS moyen du lycée",
    y = "Variation des IVAL - Lycées privés"
  ) +
  geom_smooth(method = "lm", se = FALSE, color = "darkgrey", linetype = "dashed")

  
  
  
var_IVAL_publics <- ggplot(IVAL_IPS_gt %>% filter(secteur_public == 1),
       aes(x = IPS_moy_lycee, y = var_IVAL_1624)) +
  geom_point(alpha = 0.6, size = 2, color = "steelblue") +
  theme_minimal() +
  labs(
    title = "Variation des IVAL - Lycées publics",
    x = "IPS moyen",
    y = "Variation de l'ival 2016 - 2024"
  ) +
  geom_smooth(method = "lm", se = FALSE, color = "darkgrey", linetype = "dashed")

library(patchwork)

var_IVAL_publics + var_IVAL_privés


```
ICI je fais un graph boites à moustaches pour confirmer la différence de dispersion entre les variation d'IVAL du public et du privé. Plus un test statistique qui confirme fortement ce résultat.
```{r}


ggplot(IVAL_IPS_gt, aes(x = factor(secteur_public),
                        y = var_IVAL_1624,
                        fill = factor(secteur_public))) +
  geom_boxplot(alpha = 0.6, outlier.alpha = 0.4) +
  scale_fill_manual(values = c("tomato", "steelblue"),
                    labels = c("Privé", "Public"),
                    name = "Secteur") +
  theme_minimal() +
  labs(
    title = "Dispersion des variations d’IVAL selon le secteur",
    x = "Secteur",
    y = "Variation de l’IVAL (2016–2024)"
  )



library(car)

leveneTest(var_IVAL_1624 ~ factor(secteur_public),
           data = IVAL_IPS_gt)

```

Je regarde la var des IVAL par département, voir si on a une piste d'explication de la variation ?

```{r}
var_IVAL_dep <- IVAL_IPS_gt %>%
  group_by(Département) %>%
  summarise(
    moyenne_var_IVAL = mean(var_IVAL_1624, na.rm = TRUE),
    sd_var_IVAL = sd(var_IVAL_1624, na.rm = TRUE),
    n_lycees = n()
  ) %>%
  arrange(desc(moyenne_var_IVAL))

var_IVAL_dep


var_IVAL_dep <- var_IVAL_dep %>%
  filter(!is.na(Département) & !is.na(moyenne_var_IVAL)) %>%
  distinct(Département, .keep_all = TRUE)

ggplot(var_IVAL_dep, aes(x =fct_reorder(Département, moyenne_var_IVAL), 
           y = moyenne_var_IVAL, 
           fill = moyenne_var_IVAL)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "variation moyenne par departement de l'IVAL",
    x = "Dept"
  ) + theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6)  # taille plus petite
  ) 

departements_sf <- st_read("Carto_France.gpkg", layer = "departement")  
departements_sf <- departements_sf %>%
  left_join(var_IVAL_dep, by = c("nom_officiel_en_majuscules" = "Département"))

tm_shape(departements_sf) +
  tm_fill("moyenne_var_IVAL", palette = "kovesi.blue", style = "quantile") +
  tm_layout(frame = FALSE)


```


# 4 Conclusion

Text Text

# Bibliographie

## Articles et rapports

Insee. (1998). France, portrait social. Consulté le 10 décembre 2025 sur https://www.bnsp.insee.fr/ark:/12148/bpt6k6475495h/f5

Insee. (2003). France, portrait social. Consulté le 10 décembre 2025 sur https://www.insee.fr/fr/statistiques/1371826

Insee. (2025). France, portrait social. Consulté le 10 décembre 2025 sur https://www.insee.fr/fr/statistiques/8612596

OECD. (2018). Can equity in education foster social mobility? PISA, OECD Publishing. https://doi.org/10.1787/9789264307230-en

Rocher, T. (2016). Construction d'un indice de position sociale des élèves. Éducation & Formations, (90), 5–27. https://doi.org/10.48464/ef-90-01

## Jeux de données

Institut national de l’information géographique et forestière (IGN). (2025). ADMIN-EXPRESS, édition Décembre 2025 France entière [Jeu de données géographiques]. Disponibles sur https://geoservices.ign.fr/adminexpress

Ministère de l’éducation nationale. (2023). Indices de position sociale des lycées (2016-2021) [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips_lycees

Ministère de l’éducation nationale. (2023). Indices de position sociale des lycées - Année scolaire 2022-2023 [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips-lycees-ap2022

Ministère de l’éducation nationale. (2024). Indices de position sociale des lycées - Année scolaire 2023-2024 [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips-lycees-ap2023

Ministère de l’éducation nationale. (2024). Indicateurs de valeur ajoutée des lycées d'enseignement général et technologique  [Jeu de données]. https://data.education.gouv.fr/explore/dataset/fr-en-indicateurs-de-resultat-des-lycees-gt_v2

Ministère de l’Éducation nationale. (2024). Indicateurs de valeur ajoutée des lycées professionnels [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-indicateurs-de-resultat-des-lycees-pro_v2

