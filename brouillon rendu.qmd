---
title: "Brouillon rendu"
format: 
  html:
    citeproc: false
    filters:
      - "citeproc.lua"
      - "wordcount.lua"
editor: visual
author: "jacopo hilde leopold"
code-fold: true
---

# 1 Introduction

Le sujet de la mobilité sociale et des inégalités des chances dans l’école est au centre du débat académique en France depuis longtemps. Graduellement, l’analyse sociologique sur le sujet a été intégré dans l’analyse publique au sein de l’INSEE et du ministère de l’Éducation, qui publient régulièrement des rapports, des notes d’information, et collectent des données sur des sujets clés comme les disparités sociales et territoriales dans l’éducation. Par exemple, le rapport annuel « France, portrait sociale » qui est publié depuis 1997 s’occupe régulièrement du thème des inégalités scolaires (e.g., INSEE 1997, INSEE 2003, INSEE 2025). Ainsi, au niveau international, l’OECD dédie régulièrement des chapitres à la mobilité sociale dans l’éducation dans ses rapports du Programme international pour le suivi des acquis des élèves (PISA ; e.g., OECD 2018).

L’indice de position sociale (IPS) pour les écoles en France existe depuis l’année 2016-2017. Il a été créé par la Direction de l'évaluation, de la prospective et de la performance (DEPP) au sein du ministère de l’Éducation. L’indice a été créé comme une tentative d’examiner les inégalités sociales à l’école dans une maniéré plus multiforme (Rochet 2016). Dans le passé, l’origine sociale des élèves a été surtout mesurée à travers la profession et catégorie sociale (PCS) de leurs parents ou le pourcentage d'élèves boursiers dans un établissement, qui rendent une image partielle sur le sujet. En plus, l’indice a l’objectif de créer une mesure quantitative de l’origine sociale, pour permettre plus facilement l’agrégation des données au niveau de l’établissement, de la commune, du département, etc. L’indice regroupe diffèrent catégories de données relatives à la famille d’origine des étudiants, à travers l’analyse en composantes principales. Les catégories incluent : la catégorie socio-professionnelle (PCS) et le niveau d'instruction des parents, la structure familiale (monoparentale, etc.), le conditions matérielles (revenue, taille du logement, accès a internet, etc.), et l’accès à certaines formes de capitale culturelle. Selon les auteurs, l’indice « devrait procurer un avantage pratique selon au moins deux axes d’analyse : décrire les inégalités sociales à l’école ; étudier les relations entre la performance scolaire et l’origine sociale » (Rochet 2016 : 22).

Dans cette analyse, l'IPS sera étudié en relation avec deux autres groupes d'indicateurs pour les lycées : les Indicateurs de Valeur Ajoutée des Lycées (IVAL) et l'indice d’éloignement.

Les IVAL évaluent l'efficacité d'un établissement en mesurant sa capacité à faire progresser ses élèves au-delà des simples taux de réussite bruts au baccalauréat. La « valeur ajoutée » est calculée en comparant les résultats obtenus à ceux attendus, après avoir neutralisé l'influence de facteurs externes tels que le niveau scolaire initial et le profil sociodémographique des élèves, incluant l'IPS. Un indicateur positif signifie que le lycée a mieux accompagné ses élèves que des établissements comparables, mettant ainsi en lumière son action pédagogique propre. Ces indicateurs concernent uniquement les lycées publics et privés sous contrat disposant d'un cycle complet et d'un nombre suffisant de candidats.

L'indice d’éloignement synthétise l'isolement géographique des établissements selon plusieurs dimensions : le lieu de résidence des élèves, l’offre d’enseignement et les équipements aux alentours.

Problèmatique: XXX

# 2 Méthodologie et sources

Text Text

# 3 Analysis

```{r, eval = FALSE}

#pour pouvoir convertir le markdown en pdf sans latex (il faut l'enlever du document une fois qu'on l'a installé)

install.packages('tinytex')
tinytex::install_tinytex()  # install TinyTeX
```

```{r, echo = FALSE, message = FALSE}

rm(list=ls(all=TRUE))
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(knitr)
library(here)
library(plotly)
library(here)
library(tidyverse)
library(cartogram)
library(sf)
library(tidyverse)
library(spData)
library(tmap)
library(cartogram)


# Importation des donnees:
here::i_am("M2SES.Rproj")

Annuaire <- vroom("fr-en-annuaire-education.csv")
ParcourSup <- vroom("fr-esr-parcoursup.csv")
Eloignement <- vroom("fr-en-indice_eloignement_lycee_ap2020.csv")

IPS <- vroom("fr-en-ips_lycees.csv")
IPS_2022_2023 <- vroom("fr-en-ips-lycees-ap2022.csv")
IPS_2023_2024 <- vroom("fr-en-ips-lycees-ap2023.csv")

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

# les donnees pour le Geoplot selon les regions
st_layers("France_entiere.gpkg")
region <- st_read("France_entiere.gpkg", layer="region")
region <- region |> rename(region="nom_officiel_en_majuscules")

# les donnees pour le Geoplot selon les communes (seulement France metropolitaine parce que trop compliqué de zoomé dans la carte complete)
st_layers("Carto_France.gpkg")
communes <- st_read("Carto_France.gpkg", layer="commune")
communes <- communes |> rename(commune="nom_officiel_en_majuscules")


#transformer un d.f en objet sf --> st_as_sf(objet):
IVAL_gt <-IVAL_gt %>% filter(Année == 2016 | Année==2020 | Année==2024)

#faire pivoter les IVAL pour les avoirs en colomne et se débarraser des lignes par années:
IVAL_gt <- IVAL_gt %>% rename(IVAL = `Valeur ajoutée du taux de réussite - Toutes séries`) 

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_gt <- IVAL_gt %>% select(UAI, Année, IVAL, Secteur, `Taux d'accès 2nde-bac`, `Taux de réussite - Toutes séries`) %>%
  mutate(secteur_public = if_else(Secteur == "public", 1, 0)) %>% select(-Secteur) %>%
    pivot_wider(
    names_from = Année,
    values_from = c(IVAL, `Taux d'accès 2nde-bac`, `Taux de réussite - Toutes séries` ),
    names_glue = "{.value}_{Année}"
  )

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)


#Pareil pour l'éloignement:
Eloignement <- Eloignement %>% filter(Année=="2020" | Année=="2024" ) %>%  select(UAI, Année, `Indice éloignement` ) %>%
    pivot_wider(
    names_from = Année,
    values_from = `Indice éloignement`,
    names_glue = "{.value}_{Année}"
  ) 


Eloignement %>%
  count(UAI) %>%
  filter(n > 1)



# Unifier le tables IPS
IPS_pivot_2016 <- IPS |> select(`Rentrée scolaire`, UAI, `IPS voie GT`, Secteur) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")

IPS_pivot_2022 <- IPS_2022_2023 |> select(`Rentrée scolaire`, UAI, `IPS voie GT`) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")

IPS_pivot_2024 <- IPS_2023_2024 |> select(`Rentrée scolaire`, UAI, `IPS voie GT`) |>
  pivot_wider(id_cols = UAI, names_from = 'Rentrée scolaire',
              values_from = 'IPS voie GT', , names_prefix = "IPS ")


IPS_gt <- IPS_pivot_2016 |> left_join(IPS_pivot_2022) |> left_join(IPS_pivot_2024) |> filter(!is.na(`IPS 2016-2017`)) %>% select(`IPS 2016-2017`, `IPS 2020-2021`,`IPS 2024-2025`, UAI )


IPS_gt %>%
  count(UAI) %>%
  filter(n > 1)


IVAL_IPS_gt <- inner_join(IVAL_gt,IPS_gt, by = "UAI")

IVAL_IPS_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(Eloignement, by = "UAI")

#remettre les communes mtn.

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt <- IVAL_gt %>% 
  filter(Année %in% c(2016, 2020, 2024)) %>% 
  select(UAI, Region, Département, Académie, Commune, `Code commune`) %>% 
  distinct(UAI, .keep_all = TRUE)

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(IVAL_gt, by = "UAI")





# on n'a pas besoin de la suite, c'est ca?
********************
IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(Eloignement, by = "UAI")

#remettre les communes mtn.

IVAL_gt <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt <- IVAL_gt %>% 
  filter(Année %in% c(2016, 2020, 2024)) %>% 
  select(UAI, Region, Département, Académie, Commune, `Code commune`) %>% 
  distinct(UAI, .keep_all = TRUE)

IVAL_gt %>%
  count(UAI) %>%
  filter(n > 1)

IVAL_IPS_gt <- IVAL_IPS_gt %>% inner_join(IVAL_gt, by = "UAI")

```
# Regression
montrer qu'il y a une causalité entre le IPS et le IVAL?

```{r)
# je met mes regressions. Elles sont faites sur une seule année : 2020.

IVAL_gt_2020 <- vroom("fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")

IVAL_gt_2020 <- IVAL_gt_2020 %>% filter(Année ==2020 )

IVAL_gt_2020 %>% count(UAI)

Eloignement_2020 <- vroom("fr-en-indice_eloignement_lycee_ap2020.csv")  %>% filter(Année ==2020)

# ici nous avons, juste pour 2020, l'IVAL et l'éloignement. On va cleaner et merge avec IPS.
IVAL_gt_eloignement_2020 <- merge(IVAL_gt_2020, Eloignement_2020, by = "UAI") 
IVAL_gt_eloignement_2020 <- IVAL_gt_eloignement_2020 %>% select(UAI, Etablissement, `Code région`,`Taux de réussite - Toutes séries`, `Valeur ajoutée du taux de réussite - Toutes séries`, `Indice éloignement`, `Taux d'accès 2nde-bac`)

IPS_2020 <- IPS %>% filter(`Rentrée scolaire`=="2020-2021")

IPS_IVAL_ELOI_2020 <- merge(IPS_2020, IVAL_gt_eloignement_2020, by = "UAI" ) %>% select(UAI,`Code du département`,Etablissement, Secteur, `IPS voie GT`,`Taux de réussite - Toutes séries`, `Valeur ajoutée du taux de réussite - Toutes séries`, `Indice éloignement`, `Taux d'accès 2nde-bac`) 

IPS_IVAL_ELOI_2020 <- IPS_IVAL_ELOI_2020 %>%   mutate(secteur_public = if_else(Secteur == "public", 1, 0)) %>% select(-Secteur)


reg1_2020 <- lm(
  `Valeur ajoutée du taux de réussite - Toutes séries` ~ 
    `Indice éloignement` + secteur_public + `IPS voie GT`,
  data = IPS_IVAL_ELOI_2020
)

summary(reg1_2020)

# premier résultat : cette régression n'explique PAS l'IVAL. Donc : l'IVAL est bien corrigé de l'IPS (on ne trouve pas un IVAL meilleur là où il y a des IPS élevés, même après correction), l'éloignement n'a pas d'effet sur l'IVAL, et le fait d'être public oui. Donc, piste à explorer sur le secteur public et privé. 



#régression du taux de réussite par secteur/IPS/eloignement.
reg2_2020 <- lm(
  `Taux de réussite - Toutes séries` ~ 
    `Indice éloignement` + secteur_public + `IPS voie GT`,
  data = IPS_IVAL_ELOI_2020
)

summary(reg2_2020)

# 1/3 de la variation du taux de réussite (en 2020, bac général) est expliquée par IPS + eloignement + secteur. Effet positif de l'IPS et de l'éloignement (effets robustes mais légers), effet négatif du secteur public. (effet fort et robuste). Conclusion (simple) : lycées privés = meilleur taux de réussite.
```

# Eloignement

```{r}

# Indice moyen d'éloignement par académie pour 2024 ?
# je propose qu'on enleve ca, parce-que on n'arrive pas a faire le geoplot avec les academies, et c'est un peu double avec eloignement sur region

Eloi2024_Acad <- IVAL_IPS_gt %>% group_by(Académie)  %>% summarise(moyenne_eloignement_2024 = mean(`Indice éloignement_2024`, na.rm = TRUE)) 
  
ggplot(Eloi2024_Acad, aes(x = fct_reorder(Académie, moyenne_eloignement_2024), 
           y = moyenne_eloignement_2024, 
           fill = moyenne_eloignement_2024)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Indice moyen d'éloignement par académie (2024)",
    x = "Académie",
    y = "Indice moyen"
  ) + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}

# Indice moyen d'éloignement par region pour 2024 ?

Eloi2024_Reg <- IVAL_IPS_gt |> group_by(Region)  |> summarize(moyenne_eloignement_2024 = mean(`Indice éloignement_2024`, na.rm = TRUE)) |> rename(region="Region") 
  
ggplot(Eloi2024_Reg, aes(x = fct_reorder(region, moyenne_eloignement_2024), 
           y = moyenne_eloignement_2024, 
           fill = moyenne_eloignement_2024)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Indice moyen d'éloignement par region (2024)",
    x = "Region",
    y = "Indice moyen"
  ) + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
# Visualisation des Geodonnees en relation avec l'eloignement

## Indice moyen d'eloignement par Region en 2024 pour la France metropolitaine et les territoires d'outre-mer

```{r}
# Indice moyen d'eloignement par Region pour 2024 (geoplot) - pour toute la France 
# jsp si on veut garder ca, c'est un peu moche

region_eloi <- region |> select(region, code_insee, code_siren, geometrie) |> right_join(Eloi2024_Reg, by="region")

metropole <- region_eloi |> filter(!code_insee %in% c("01","02","03","04","06"))
guadeloupe <- region_eloi |> filter(code_insee == "01") # o "971"
martinique <- region_eloi |> filter(code_insee == "02") # o "972"
guyane     <- region_eloi |> filter(code_insee == "03") # o "973"
reunion    <- region_eloi |> filter(code_insee == "04") # o "974"
mayotte    <- region_eloi |> filter(code_insee == "06") # o "976"

tm_shape(metropole) + tm_fill(fill="moyenne_eloignement_2024",
                             fill.scale=tm_scale_intervals(values="kovesi.blue", n=10,
                                                           style="quantile")) + tm_layout(frame=FALSE, component.autoscale = FALSE, fill.legend = tm_title("Moyenne éloignement 2024")) + tm_title ("France métropolitaine", frame = TRUE)
                                    

m_gua <- tm_shape(guadeloupe) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Guadeloupe")
m_mar <- tm_shape(martinique) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Martinique")
m_guy <- tm_shape(guyane) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Guyane")
m_reu <- tm_shape(reunion) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Réunion")
m_may <- tm_shape(mayotte) + tm_fill("moyenne_eloignement_2024", fill.legend = tm_legend(title = "Moyenne éloignement 2024")) + tm_title("Mayotte")

tmap_arrange(m_gua, m_mar, m_guy, m_reu, m_may, ncol = 5, nrow = 2)


```

# IVAL

```{r}
# IVAL selon les communes 2016 (geoplot) ?
# faut encore y travailler

IVAL_2016 <- IVAL_IPS_gt |> rename(commune="Commune") |> select(IVAL_2016, commune) 

IVAL_communes <- communes |>  select(commune, code_insee, geometrie) |> right_join(IVAL_2016, by="commune") 


tm_shape(IVAL_communes) + tm_fill(fill="IVAL_2016",
                             fill.scale=tm_scale_intervals(values="kovesi.blue", n=5
                                                           style="quantile")) + tm_layout(frame =FALSE, component.autoscale = FALSE)
```

# Public et privé

```{r}

# nombre de lycées privés par académie.

priv_acad <- IVAL_IPS_gt %>%
  filter(secteur_public == 0) %>%         
  group_by(Académie) %>%
  summarise(nb_prives = n()) 

ggplot(priv_acad, aes(x=fct_reorder(Académie,nb_prives), y=nb_prives, fill=nb_prives)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
#IPS moyen par Académie. Peut être qu'il faut recflechir à des pondérations...
IVAL_IPS_gt <- IVAL_IPS_gt %>%
  mutate(IPS_moy_lycee = rowMeans(
    select(., `IPS 2016-2017`, `IPS 2020-2021`, `IPS 2024-2025`),
    na.rm = TRUE
  ))

IPS_acad <- IVAL_IPS_gt %>%
  group_by(Académie) %>%
  summarise(IPS_moyen = mean(IPS_moy_lycee, na.rm = TRUE))

IPS_acad %>% ggplot(aes(x=fct_reorder(Académie,IPS_moyen), y=IPS_moyen, fill=IPS_moyen)) + geom_bar(stat="identity") + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
# 4 Conclusion

Text Text

# Bibliographie

## Articles et rapports

Insee. (1998). France, portrait social. Consulté le 10 décembre 2025 sur https://www.bnsp.insee.fr/ark:/12148/bpt6k6475495h/f5

Insee. (2003). France, portrait social. Consulté le 10 décembre 2025 sur https://www.insee.fr/fr/statistiques/1371826

Insee. (2025). France, portrait social. Consulté le 10 décembre 2025 sur https://www.insee.fr/fr/statistiques/8612596

OECD. (2018). Can equity in education foster social mobility? PISA, OECD Publishing. https://doi.org/10.1787/9789264307230-en

Rocher, T. (2016). Construction d'un indice de position sociale des élèves. Éducation & Formations, (90), 5–27. https://doi.org/10.48464/ef-90-01

## Jeux de données

Institut national de l’information géographique et forestière (IGN). (2025). ADMIN-EXPRESS, édition Décembre 2025 France entière [Jeu de données géographiques]. Disponibles sur https://geoservices.ign.fr/adminexpress

Ministère de l’éducation nationale. (2023). Indices de position sociale des lycées (2016-2021) [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips_lycees

Ministère de l’éducation nationale. (2023). Indices de position sociale des lycées - Année scolaire 2022-2023 [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips-lycees-ap2022

Ministère de l’éducation nationale. (2024). Indices de position sociale des lycées - Année scolaire 2023-2024 [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-ips-lycees-ap2023

Ministère de l’éducation nationale. (2024). Indicateurs de valeur ajoutée des lycées d'enseignement général et technologique  [Jeu de données]. https://data.education.gouv.fr/explore/dataset/fr-en-indicateurs-de-resultat-des-lycees-gt_v2

Ministère de l’Éducation nationale. (2024). Indicateurs de valeur ajoutée des lycées professionnels [Jeu de données]. Disponibles sur https://data.education.gouv.fr/explore/dataset/fr-en-indicateurs-de-resultat-des-lycees-pro_v2

